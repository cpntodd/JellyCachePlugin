<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jelly Cache Manager</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        button { padding: 10px 15px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Jelly Cache Manager</h1>

    <div class="section">
        <h2>Cache Directory Overview</h2>
        <table id="cacheTable">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Path</th>
                    <th>Current Size</th>
                    <th>Max Size</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be populated by JavaScript -->
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>Configuration</h2>
        <form id="configForm">
            <label>Cleanup Interval (hours): <input type="number" id="cleanupInterval" /></label><br>
            <label>Enable Alerts: <input type="checkbox" id="enableAlerts" /></label><br>
            <label>Alert Threshold (%): <input type="number" id="alertThreshold" /></label><br>
            <button type="button" onclick="saveConfig()">Save Configuration</button>
        </form>
    </div>

    <div class="section">
        <h2>Manual Cleanup</h2>
        <button onclick="clearAllCaches()">Clear All Caches</button>
        <button onclick="clearCache('ImageCache')">Clear Image Cache</button>
        <button onclick="clearCache('Transcodes')">Clear Transcodes</button>
        <button onclick="rebuildImageCache()">Rebuild Image Cache</button>
    </div>

    <div class="section">
        <h2>Logs</h2>
        <textarea id="logs" rows="10" cols="80" readonly></textarea>
    </div>

    <script>
        // Load data on page load
        window.onload = function() {
            loadCacheData();
            loadConfig();
            loadLogs();
        };

        function loadCacheData() {
            // Fetch from API endpoint (need to implement in plugin)
            fetch('/Plugins/JellyCachePlugin/CacheData')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('cacheTable').querySelector('tbody');
                    tbody.innerHTML = '';
                    data.forEach(item => {
                        const row = `<tr>
                            <td>${item.category}</td>
                            <td>${item.path}</td>
                            <td>${item.currentSize}</td>
                            <td>${item.maxSize}</td>
                            <td>${item.status}</td>
                        </tr>`;
                        tbody.innerHTML += row;
                    });
                });
        }

        function loadConfig() {
            fetch('/Plugins/JellyCachePlugin/Config')
                .then(response => response.json())
                .then(config => {
                    document.getElementById('cleanupInterval').value = config.cleanupIntervalHours;
                    document.getElementById('enableAlerts').checked = config.enableAlerts;
                    document.getElementById('alertThreshold').value = config.alertThresholdPercent;
                });
        }

        function saveConfig() {
            const config = {
                cleanupIntervalHours: parseInt(document.getElementById('cleanupInterval').value),
                enableAlerts: document.getElementById('enableAlerts').checked,
                alertThresholdPercent: parseInt(document.getElementById('alertThreshold').value)
            };
            fetch('/Plugins/JellyCachePlugin/Config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(config)
            }).then(() => alert('Configuration saved'));
        }

        function clearAllCaches() {
            fetch('/Plugins/JellyCachePlugin/ClearAll', { method: 'POST' })
                .then(() => {
                    alert('All caches cleared');
                    loadCacheData();
                });
        }

        function clearCache(category) {
            fetch(`/Plugins/JellyCachePlugin/Clear/${category}`, { method: 'POST' })
                .then(() => {
                    alert(`${category} cleared`);
                    loadCacheData();
                });
        }

        function rebuildImageCache() {
            fetch('/Plugins/JellyCachePlugin/RebuildImageCache', { method: 'POST' })
                .then(() => alert('Image cache rebuild initiated'));
        }

        function loadLogs() {
            fetch('/Plugins/JellyCachePlugin/Logs')
                .then(response => response.text())
                .then(logs => document.getElementById('logs').value = logs);
        }
    </script>
</body>
</html>